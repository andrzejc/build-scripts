#!/usr/bin/env bash
## Wrapper for downloading and extracting import library from LAME binary release
## If no params provided, use 3.100
## winstall-lame [<target-platform>] [<binary-url> <binary-hash> <header-url>]
set -eu
set -o pipefail

function winstall_lame {
    local target_platform="${1:-x64}"
    local url="${2:-https://github.com/andrzejc/libmp3lame-windows-release/releases/download/3.100/lame-3.100-win-amd64.zip}"
    local hash="${3:-b1286ef97251d1f64e1f47a87cf462eb84447561}"
    local this_dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
    local temp_dir=
    temp_dir=$( mktemp -d )
    trap "> /dev/null 2>&1 rm -rf '${temp_dir}' || true" EXIT

    local binary_archive=
    binary_archive=$( "${this_dir}/safe-download" "${url}" "${temp_dir}" "${hash}" )
    local install_dir=
    install_dir=$( "${this_dir}/get-windows-program-files-dir" "${target_platform}" )
    >&2 unzip "${binary_archive}" -d "${install_dir}"
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    winstall_lame "$@"
fi
