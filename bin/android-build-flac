#! /usr/bin/env bash
set -e -o pipefail
set +x
# optional dependencies: ogg, iconv
OGG_PATH="${OGG_PATH:-${HOME}/android-deps/libogg-1.3.4}"
ICONV_PATH="${ICONV_PATH:-${HOME}/android-deps/libiconv-1.16}"

THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SOURCE_URL="${SOURCE_URL:-https://ftp.osuosl.org/pub/xiph/releases/flac/flac-1.3.3.tar.xz}"

function run_configure() {
    [[ -z "${ICONV_PATH:-}" ]] || {
        export CFLAGS="${CFLAGS:-} -I${ICONV_PATH}/${ABI}/include"
        export LDFLAGS="${LDFLAGS:-} -L${ICONV_PATH}/${ABI}/lib"
    }
    ./configure "$@" \
        ${ICONV_PATH:+"--with-libiconv-prefix=${ICONV_PATH}/${ABI}"} \
        ${OGG_PATH:+"--with-ogg=${OGG_PATH}/${ABI}"}
}

source "${THIS_DIR}/android-autotools-build.sh" \
    --disable-doxygen-docs \
    --disable-xmms-plugin
