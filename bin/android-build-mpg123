#! /usr/bin/env bash
set -e -o pipefail
set +x
# optional dependencies:
THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SOURCE_URL="${SOURCE_URL:-https://sourceforge.net/projects/mpg123/files/mpg123/1.26.4/mpg123-1.26.4.tar.bz2}"

function run_configure() {
    local opts
    case "${TARGET}" in
    armv7a-*)
        opts+=(--with-cpu=arm_fpu) ;;
    aarch64=*)
        opts+=(--with-cpu=aarch64) ;;
    i686-*)
        # XXX CPU x86 produces non-relocatable assembler output, to be investigated
        # opts+=(--with-cpu=x86)
        opts+=(--with-cpu=generic_fpu) ;;
    x86_64-*)
        opts+=(--with-cpu=x86-64) ;;
    esac
    ./configure "${opts[@]}" "$@"
}

source "${THIS_DIR}/android-autotools-build.sh" \
    --enable-modules=no \
    --with-default-audio=dummy
