#! /usr/bin/env bash
set -e -o pipefail
set +x
# optional dependencies: ogg, speexdsp
OGG_PATH="${OGG_PATH:-${HOME}/android-deps/libogg-1.3.4}"
SPEEXDSP_PATH="${SPEEXDSP_PATH:-${HOME}/android-deps/speexdsp-1.2.0}"

THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SOURCE_URL="${SOURCE_URL:-https://downloads.xiph.org/releases/speex/speex-1.2.0.tar.gz}"

function run_configure() {
    export -n PKG_CONFIG_LIBDIR
    [[ -z "${OGG_PATH:-}" ]] || {
        export OGG_CFLAGS="-I${OGG_PATH}/${ABI}/include"
        export OGG_LIBS="-L${OGG_PATH}/${ABI}/lib"
    }
    [[ -z "${SPEEXDSP_PATH:-}" ]] || {
        export SPEEXDSP_CFLAGS="-I${SPEEXDSP_PATH}/${ABI}/include"
        export SPEEXDSP_LIBS="-L${SPEEXDSP_PATH}/${ABI}/lib"
    }
    local args=()
    case "${TARGET}" in
    i686-*|x86_64-*)
        args+=(--enable-sse) ;;
    esac
    PKG_CONFIG_LIBDIR="${PKG_CONFIG_LIBDIR:-}" \
        ./configure "${args[@]}" "$@"
}

source "${THIS_DIR}/android-autotools-build.sh" \
    --disable-binaries
